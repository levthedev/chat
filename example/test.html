<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- <script async>
      (function (){
        function addChatLogic (){
          var script = document.createElement('script');
          script.src = '../client/chat.js' // TODO add real src
          script.async = !0
          script.onload = function(){
            __init('') // TODO add real key
          }
          document.getElementsByTagName('head')[0].appendChild(script)
        }
        window.attachEvent ? window.attachEvent('onload', addChatLogic) : window.addEventListener('load', addChatLogic, !1)
      })();
    </script> -->
    <script>
      var messages = {}
      function toggleChat(state) {
        var open = document.getElementById('open');
        var closed = document.getElementById('closed');
        var conversation = document.getElementById('conversation')
        if (state === 'closed') {
          closed.style.display = 'none';
          open.style.display = 'block';
          conversation.style.display = 'block'
        } else if (state === 'open') {
          closed.style.display = 'block';
          open.style.display = 'none';
          conversation.style.display = 'none'
        }
      }
      function httpGetAsync(url, callback) {
        var xmlHttp = new XMLHttpRequest();
        xmlHttp.onreadystatechange = function() {
          if (xmlHttp.readyState == 4 && xmlHttp.status == 200) {
            callback(xmlHttp.responseText);
          }
        }
        xmlHttp.open('GET', url, true);
        xmlHttp.send(null);
      }

      function populateChat(conversation) {
        var messagesNode = document.getElementById('messages');
        var inputNode = document.getElementById('input');
        messages = Object.values(JSON.parse(conversation).messages);
        messages.forEach(function(message, i) {
          var messageNode = document.createElement('p');
          messageNode.className = 'message';
          messageNode.textContent = message.text;
          if (message.sender == 'customer') {
            messageNode.className += ' customer';
          } else {
            messageNode.className += ' company';
          }
          messagesNode.appendChild(messageNode);

          var timeStampNode = document.createElement('div');
          timeStampNode.className = 'timestamp';
          timeStampNode.textContent = message.time;
          if (message.sender == 'customer') {
            timeStampNode.className = 'customerTime';
          } else {
            timeStampNode.className = 'companyTime';
          }
          messagesNode.appendChild(timeStampNode);
        })
      }

      (function getChatLogs() {
        httpGetAsync('../client/conversation.json', populateChat)
      })()
    </script>
    <link rel='stylesheet' href='./styles.css' type='text/css'>
  </head>
  <body>
    <div id='scrolly'></div>
    <div id='container'>
      <div id='conversation'>
        <div id='header'>
          Conversation with Lev
        </div>
        <div id='messages'>
        </div>
        <div id="inputWrapper">
          <input id="input" placeholder="Send a message..."></input>
          <div id="powered"><a href="https://github.com/levthedev">Powered by OpenChat</a></div>
        </div>
      </div>
      <div id='closed' onclick="toggleChat('closed')">
      </div>
      <div id='open' onclick="toggleChat('open')">
      </div>
    </div>
  </body>
</html>
